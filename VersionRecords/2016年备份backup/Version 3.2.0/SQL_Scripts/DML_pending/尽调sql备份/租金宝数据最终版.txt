SELECT 
  loan_landlord_contract.landlordId AS '房东ID',
  loan_landlord_contract.applyTime AS '租金宝申请日期',
  CASE
    WHEN loan_landlord_contract.`canLoan` = 0 
    THEN '不能贷款' 
    WHEN loan_landlord_contract.`canLoan` = 1 
    THEN '可以贷款' 
    WHEN loan_landlord_contract.`canLoan` = 2 
    THEN '暂停贷款' 
    WHEN loan_landlord_contract.`canLoan` = 3 
    THEN '停止贷款' 
  END AS '租金宝贷款状态',
  CASE
    WHEN loan_landlord_contract.loanChannel IS NULL 
    OR loan_landlord_contract.loanChannel IN (1, 2) 
    THEN IFNULL(
      (SELECT 
        loan_landlord_credit.credits 
      FROM
        loan_landlord_credit 
      WHERE loan_landlord_credit.`landlordId` = loan_landlord_contract.`landlordId`),
      0
    ) 
    ELSE IFNULL(
      (SELECT 
        loan_landlord_credit.credits2 
      FROM
        loan_landlord_credit 
      WHERE loan_landlord_credit.landlordId = loan_landlord_contract.landlordId),
      0
    ) 
  END '信用额度',
  (
    IFNULL(
      (SELECT 
        IFNULL(
          COUNT(loan_landlord_payplan.id),
          0
        ) AS payCount 
      FROM
        loan_landlord_payplan 
        INNER JOIN loan_contract 
          ON loan_contract.relContractId > 0 
          AND loan_landlord_payplan.loanid = loan_contract.id 
          AND loan_landlord_payplan.loanChannel = 3 
          AND loan_landlord_payplan.`payStatus` = 4 
      WHERE loan_contract.`borrowerInfoId` = loan_landlord_contract.`landlordId`),
      0
    ) + IFNULL(
      (SELECT 
        IFNULL(
          COUNT(loan_landlord_payplan.id),
          0
        ) AS payCount 
      FROM
        loan_landlord_payplan 
        INNER JOIN loan_landlord_mgmt 
          ON loan_landlord_payplan.loanId = loan_landlord_mgmt.id 
          AND (
            loan_landlord_payplan.`loanChannel` IS NULL 
            OR loan_landlord_payplan.`loanChannel` IN (1, 2)
          ) 
          AND loan_landlord_payplan.`payStatus` = 4 
      WHERE loan_landlord_mgmt.`landlordId` = loan_landlord_contract.`landlordId`),
      0
    )
  ) AS '已放款笔数',
  (
    IFNULL(
      (SELECT 
        IFNULL(
          SUM(
            loan_landlord_payplan.actualAmount
          ),
          0
        ) AS payCount 
      FROM
        loan_landlord_payplan 
        INNER JOIN loan_contract 
          ON loan_contract.relContractId > 0 
          AND loan_landlord_payplan.loanid = loan_contract.id 
          AND loan_landlord_payplan.loanChannel = 3 
          AND loan_landlord_payplan.`payStatus` = 4 
      WHERE loan_contract.`borrowerInfoId` = loan_landlord_contract.`landlordId`),
      0
    ) + IFNULL(
      (SELECT 
        IFNULL(
          SUM(
            loan_landlord_payplan.actualAmount
          ),
          0
        ) AS payCount 
      FROM
        loan_landlord_payplan 
        INNER JOIN loan_landlord_mgmt 
          ON loan_landlord_payplan.loanId = loan_landlord_mgmt.id 
          AND (
            loan_landlord_payplan.`loanChannel` IS NULL 
            OR loan_landlord_payplan.`loanChannel` IN (1, 2)
          ) 
          AND loan_landlord_payplan.`payStatus` = 4 
      WHERE loan_landlord_mgmt.`landlordId` = loan_landlord_contract.`landlordId`),
      0
    )
  ) AS '已放款金额',
  (
    (SELECT 
      COUNT(1) 
    FROM
      loan_landlord_buyback 
      INNER JOIN loan_contract 
        ON loan_landlord_buyback.`loanId` = loan_contract.id 
        AND loan_contract.`relContractId` > 0 
        AND loan_landlord_buyback.`loanChannel` = 3 
        AND loan_landlord_buyback.`buyBackStatus` = 2 
    WHERE loan_landlord_buyback.`landlordId` = loan_landlord_contract.`landlordId`) + 
    (SELECT 
      COUNT(1) 
    FROM
      loan_landlord_buyback 
      INNER JOIN loan_landlord_mgmt 
        ON loan_landlord_buyback.`loanId` = loan_landlord_mgmt.id 
        AND (
          loan_landlord_buyback.`loanChannel` IS NULL 
          OR loan_landlord_buyback.`loanChannel` IN (1, 2)
        ) 
        AND loan_landlord_buyback.`buyBackStatus` = 2 
    WHERE loan_landlord_buyback.`landlordId` = loan_landlord_contract.`landlordId`)
  ) AS '买回笔数',
  '' AS '买回逾期次数',
  CASE
    WHEN user_special.id IS NOT NULL 
    THEN '是' 
  END AS '是否是测试数据' 
FROM
  loan_landlord_contract 
  LEFT JOIN user_special 
    ON user_special.`userId` = loan_landlord_contract.`landlordId` 
    AND user_special.`userType` = 0 
ORDER BY loan_landlord_contract.landlordId 