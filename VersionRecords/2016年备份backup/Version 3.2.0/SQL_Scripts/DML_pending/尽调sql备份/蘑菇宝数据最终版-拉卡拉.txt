SELECT 
  c.name AS '城市',
  oso.id AS '签约单ID',
  ur.id AS '租客ID',
  ul.id AS '房东ID',
  COUNT(lrc.id) AS '蘑菇宝申请次数',
  CASE
    oso.status 
    WHEN 0 
    THEN '签约不通过' 
    WHEN 1 
    THEN '签约待审核' 
    WHEN 2 
    THEN '签约待支付' 
    WHEN 3 
    THEN '签约资料有误' 
    WHEN 4 
    THEN '签约成功' 
    WHEN 5 
    THEN '已退房' 
    WHEN 6 
    THEN '合同到期未退房' 
    WHEN 7 
    THEN '转客待确认' 
    WHEN 8 
    THEN '转客待修改' 
    WHEN 21 
    THEN '支付待确认' 
    WHEN 22 
    THEN '签约已撤销' 
    WHEN 23 
    THEN '首期款已付待处理' 
    WHEN 24 
    THEN '租约待确认' 
    WHEN 98 
    THEN '签约已过期' 
    WHEN 99 
    THEN '已删除' 
  END AS '签约单状态',
  CASE
    lrc.status 
    WHEN 1 
    THEN '审核中' 
    WHEN 2 
    THEN '放款失败' 
    WHEN 4 
    THEN '已还清' 
    WHEN 5 
    THEN '已逾期' 
    WHEN 9 
    THEN '钱款结清' 
    WHEN 3 
    THEN '放款成功' 
    WHEN 6 
    THEN '审核失败' 
    WHEN 7 
    THEN '合同终止' 
    WHEN 8 
    THEN '取消合同' 
    WHEN 10 
    THEN '款项到位' 
    WHEN 11 
    THEN '合同待终止' 
  END AS '蘑菇宝状态',
  fr.salePrice AS '实际租金',
  lrc.applyamt'租客申请金额',
  (SELECT 
    MAX(t.loantime) 
  FROM
    loan_renter_contract t 
  WHERE t.infoid = lri.id) AS '资方放款时间',
  '' AS '资方放款金额',
  lrch.checkTime AS '蘑菇终审时间',
  lrc.confirmTime AS '蘑菇放款时间',
  llp.actualAmount AS '蘑菇放款净额',
  COUNT(lrr.id) AS '租客逾期次数',
  CASE
    WHEN llb.id IS NOT NULL 
    THEN '是' 
  END '房东是否买回',
  llb.buyBackDate AS '房东买回时间',
  CASE
    WHEN user_special.id IS NOT NULL 
    OR usrenter.id IS NOT NULL 
    THEN '是' 
  END AS '是否是测试数据' 
FROM
  loan_renter_contract lrc 
  LEFT JOIN loan_renter_info lri 
    ON lrc.infoId = lri.id 
  LEFT JOIN user_renter ur 
    ON lrc.renterId = ur.id 
  LEFT JOIN user_landlord ul 
    ON lrc.landlordId = ul.id 
  LEFT JOIN oder_signedorder oso 
    ON lri.signedOrderId = oso.id 
  LEFT JOIN cntr_salecontract csc 
    ON oso.saleContractId = csc.id 
  LEFT JOIN flat_room fr 
    ON fr.id = oso.roomId 
  LEFT JOIN flat_flats ff 
    ON oso.flatsId = ff.id 
  LEFT JOIN city c 
    ON lri.cpCityId = c.id 
  LEFT JOIN flat_community fc 
    ON ff.communityId = fc.id 
  LEFT JOIN loan_landlord_mgmt llm 
    ON llm.bizContractId = lrc.id 
  LEFT JOIN loan_landlord_payplan llp 
    ON llp.loanId = llm.id 
AND llp.loanchannel !=3
  LEFT JOIN loan_renter_check lrch 
    ON lrch.loanContractId = lrc.id 
  LEFT JOIN loan_landlord_buyback llb 
    ON llb.loanId = llm.id 
  LEFT JOIN user_special 
    ON user_special.userId = oso.landlordid 
    AND user_special.userType = 0 
  LEFT JOIN user_special usrenter 
    ON usrenter.userid = oso.renterId 
    AND usrenter.usertype = 4 
  LEFT JOIN loan_renter_repay lrr 
    ON lrr.contractno = lrc.contractno 
    AND lrr.type IN (2, 3) 
GROUP BY oso.id 