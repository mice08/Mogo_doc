SELECT 
  c.name AS '城市',
  oder_signedorder.id AS '签约单ID',
  user_renter.id AS '租客ID',
  ul.id AS '房东ID',
  COUNT(loan_renter_contract.id) AS '蘑菇宝申请次数',
  CASE
    oder_signedorder.status 
    WHEN 0 
    THEN '签约不通过' 
    WHEN 1 
    THEN '签约待审核' 
    WHEN 2 
    THEN '签约待支付' 
    WHEN 3 
    THEN '签约资料有误' 
    WHEN 4 
    THEN '签约成功' 
    WHEN 5 
    THEN '已退房' 
    WHEN 6 
    THEN '合同到期未退房' 
    WHEN 7 
    THEN '转客待确认' 
    WHEN 8 
    THEN '转客待修改' 
    WHEN 21 
    THEN '支付待确认' 
    WHEN 22 
    THEN '签约已撤销' 
    WHEN 23 
    THEN '首期款已付待处理' 
    WHEN 24 
    THEN '租约待确认' 
    WHEN 98 
    THEN '签约已过期' 
    WHEN 99 
    THEN '已删除' 
  END AS '签约单状态',
  CASE
    loan_renter_contract.status 
    WHEN 1 
    THEN '审核中' 
    WHEN 2 
    THEN '放款失败' 
    WHEN 4 
    THEN '已还清' 
    WHEN 5 
    THEN '已逾期' 
    WHEN 9 
    THEN '钱款结清' 
    WHEN 3 
    THEN '放款成功' 
    WHEN 6 
    THEN '审核失败' 
    WHEN 7 
    THEN '合同终止' 
    WHEN 8 
    THEN '取消合同' 
    WHEN 10 
    THEN '款项到位' 
    WHEN 11 
    THEN '合同待终止' 
  END AS '蘑菇宝状态',
  fr.salePrice AS '实际租金',
  (SELECT 
    MAX(t.loantime) 
  FROM
    loan_renter_contract t 
  WHERE t.infoid = lri.id) AS '资方放款给蘑菇时间',
  '' AS '资方放款金额',
  loan_renter_check.checkTime AS '蘑菇终审时间',
  loan_renter_contract.confirmTime AS '财务确认款项到位时间',
  MAX(loan_landlord_payplan.payDate) '蘑菇放款给房东时间',
  loan_landlord_payplan.actualAmount AS '蘑菇放款金额',
  COUNT(lrr.id) AS '租客逾期次数',
  loan_landlord_buyback.buyBackDate AS '房东买回时间',
  CASE
    WHEN user_special.id IS NOT NULL 
    OR usrenter.id IS NOT NULL 
    THEN '是' 
  END AS '是否是测试数据' 
FROM
  oder_signedorder 
  LEFT JOIN cntr_salecontract 
    ON oder_signedorder.saleContractId = cntr_salecontract.id 
  LEFT JOIN loan_renter_info lri 
    ON lri.signedOrderId = oder_signedorder.id 
  LEFT JOIN loan_renter_contract 
    ON loan_renter_contract.infoId = lri.id 
    AND loan_renter_contract.`channel` = 1 
  LEFT JOIN user_renter 
    ON loan_renter_contract.renterId = user_renter.id 
  LEFT JOIN user_landlord ul 
    ON loan_renter_contract.landlordId = ul.id 
  LEFT JOIN flat_room fr 
    ON fr.id = oder_signedorder.roomId 
  LEFT JOIN flat_flats ff 
    ON oder_signedorder.flatsId = ff.id 
  LEFT JOIN city c 
    ON lri.cpCityId = c.id 
  LEFT JOIN flat_community fc 
    ON ff.communityId = fc.id 
  LEFT JOIN loan_landlord_mgmt 
    ON loan_landlord_mgmt.bizContractId = loan_renter_contract.id 
  LEFT JOIN loan_landlord_payplan 
    ON loan_landlord_payplan.loanId = loan_landlord_mgmt.id 
    AND loan_landlord_payplan.`loanChannel` = 1 
  LEFT JOIN loan_renter_check 
    ON loan_renter_check.loanContractId = loan_renter_contract.id 
    AND loan_renter_check.`loanChannel` = 1 
  LEFT JOIN loan_landlord_buyback 
    ON loan_landlord_buyback.loanId = loan_landlord_mgmt.id 
    AND loan_landlord_buyback.`loanChannel` = 1 
  LEFT JOIN user_special 
    ON user_special.userId = oder_signedorder.landlordid 
    AND user_special.userType = 0 
  LEFT JOIN user_special usrenter 
    ON usrenter.userid = oder_signedorder.renterId 
    AND usrenter.usertype = 4 
  LEFT JOIN loan_renter_repay lrr 
    ON lrr.contractno = loan_renter_contract.contractno 
    AND lrr.type IN (2, 3) 
WHERE cntr_salecontract.`contractType` = 1 
  AND lri.`channel` = 1 
GROUP BY oder_signedorder.id 