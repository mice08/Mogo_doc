/*  Database name `mogoroomdb` ，删除没有房间的合租房源;(执行之前数据备份，备份，备份)*/
use mogoroomdb;

UPDATE flat_flats t, 
(
	SELECT ff.`id`
	FROM flat_flats ff
	LEFT JOIN (
		SELECT flatsid ,COUNT(*) roomCount
		FROM flat_room fr 
		WHERE fr.`status` =1
		GROUP BY flatsid
	) fr ON ff.`id` = fr.flatsid
	WHERE IFNULL(roomCount,0) = 0
	AND ff.`status` = 1
	AND ff.`flatsTag` = 1
	AND ff.`rentType`=2 
)tt	
SET t.`status`=0 
WHERE t.id=tt.id AND t.`rentType`=2 AND t.`flatsTag`=1;